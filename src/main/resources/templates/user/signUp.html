<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=3.0">

<link rel="stylesheet" href="../assets/css/login.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
<title>signUp</title>
<style type="text/css">

main {
	margin-top: 5rem;
}

h2 {
	padding-bottom: 10px;
	font-size: 30px;
	color: dark gray;
	font-weight: bold;
}

.form-wrapper {
	text-align: center;
	margin: 100px auto;
}

#joinForm {
	width: 700px;
	margin: 50px auto;
}

.input-wrapper {
	margin-top: 20px;
	margin-left: 180px;
	padding-bottom: 5px;
	display: flex;
	justify-content: space-between;
	align-items: center;
	font-size: 13px;
	font-weight: bold;
}

#joinForm input {
	height: 35px;
}


label {
  display: block;
}


</style>
<script type="text/javascript"
	src="http://code.jquery.com/jquery-latest.js"></script>




</head>
<body>
	<!--사이드바-->
	<div class="fx">
		<a href="#"> <img class="main"
			src="https://www.slou.co.kr/img/front/btn/cartBtn.png" width="50"></a>
		<a href="#"><img class="main"
			src="https://www.slou.co.kr/img/front/btn/searchBtn.png" width="50"></a>
	</div>


	<!--title-->
	<div class="d-box">
		<div class="titl">
			<div style="float: left; margin: 0 20px;">
				<a href="../user/logo">
				<img class="main" src="../image/logo.png" width="70"></a>
			</div>
			<ul class="f-list">
				<li><a href="#">Best</a></li>
				<li><a href="#">Products</a>
					<ul class="list-s">
						<li style="font-size: 0.8rem;"><a href="#">ring</a></li>
						<li style="font-size: 0.8rem;"><a href="#">bracelet</a></li>
						<li style="font-size: 0.8rem;"><a href="#">necklace</a></li>
						<li style="font-size: 0.8rem;"><a href="#">earing</a></li>
						<li style="font-size: 0.8rem;"><a href="#">watch</a></li>
						<li style="font-size: 0.8rem;"><a href="#">object</a></li>
					</ul></li>
				<li><a href="#">QnA</a></li>
				<li><a href="#">Notice</a></li>
			</ul>
				<ul class="s-list">
				<li><a href="#">찜하기</a></li>
				<li><a href="#">장바구니</a></li>
				<li><a href="">검색</a></li>
				<li><a href="user/login">로그인</a></li>
			
			</ul>
		</div>

	<div class="entire-wrap">

		<main>
			<div class="form-wrapper">
				<form id="joinForm" action="join" method="post">
					<h2>Account</h2>

					<br>
					<br>
				
					<div class="input-essential" align="right" style="right: auto;color: dark gray; ;font-size:0.5rem;">
							<label for="essential">*필수입력사항</label>
						</div>
					<div class="input-area">
						<div class="input-wrapper">
							<label for="userId">*ID</label>
						</div>
						<div>
							<input type="text" id="userId" name="userId" size="40"
								placeholder="영문소문자, 숫자 조합으로 4~16자리" required>
							<button type="button" id="btnIdCheck"
								style="width: 70px; height: 40px;">중복체크</button>
						</div>
						<p id="idValidation" align="left" style="color: red; font-size: 0.3rem; ">
						  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						아이디는 영문소문자, 숫자 조합의 4~16자리로 설정해주세요.</p>
						<div class="input-wrapper">
							<label for="userPwd">*Password</label>
						</div>
						<div>
							<input type="password" id="userPwd" name="userPwd" size="55"
								placeholder="영문대소문자, 숫자, 특수문자 2가지 이상 조합으로 8~16자리" required>
						</div>
						<p id="pwValidation" style="color: red; font-size: 0.3rem;" align="center">
						 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						 비밀번호는 영문대소문자, 숫자, 특수문자 2가지 이상 조합의 8~16자리로 설정해주세요.</p>
						<div class="input-wrapper">
							<label for="userPwCheck">*비밀번호 확인</label>
						</div>
						<div>
						 <input type="password" id="userPwCheck" name="userPwCheck"
								size="55" placeholder="영문대소문자, 숫자, 특수문자 2가지 이상 조합으로 8~16자리"
								required>
						</div>
						<br>
						<p id="pwCheckResult" style="font-size: 0.8rem;"></p>
						<div class="input-wrapper">
							<label for="userName">*Name</label>
						</div>
						<div>
						<input type="text" id="userName" name="userName" size="55"
								placeholder="이름" required>
						</div>
						<div class="input-wrapper">
						<label for="userAddress">*Address</label>
						</div>
						<div class="form-group">
							     &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
							     <input class="form-control" style="width: 40%; display: inline;"
								placeholder="우편번호" name="userAddr1" id="userAddr1" type="text"
								readonly="readonly">
							<button type="button" class="btn btn-default"
								onclick="execPostCode();">
								<i class="fa fa-search"></i> 우편번호 찾기
							</button>
						</div>
						<div class="form-group">
							
							<div>
							<input class="form-control" type="text"  id="userAddr2" name="userAddr2" size="55"
								style="display: inline;" readonly="readonly"  placeholder="도로명 주소" required >
						</div>
						</div>
						
						
	
						<div class="form-group">
							<input class="form-control" placeholder="상세주소" name="userAddr3"size="55"
								id="userAddr3" type="text" />
						</div>

						<div class="input-wrapper">
							<label for="userMobile">*Mobile</label>
						</div>
						<div>
							<input type="text" id="userMobile" name="userMobile" size="55"
								placeholder="모바일" required>
						</div>
						<div class="input-wrapper">
							<label for="userPhone">Phone</label>
						</div>
						<div>
							<input type="text" id="userPhone" name="userPhone" size="55"
								placeholder="전화" required>
						</div>
						<div class="input-wrapper">
							<label for="userEmail">*Email</label>
						</div>
						<div>
							<input type="text" id="userEmail" name="userEmail" size="45" placeholder="이메일" required>
						<button onClick="checkEmail(document.getElementById('userEmail').value)" class="btn btn-outline-primary" type="button">인증번호</button>
						
						</div>
						
						
	
	
	<div class="form-group last mb-4 check_input" style=" margin-top: 10px;
	margin-left: 175px;
	padding-bottom: 5px;
	display: flex;
	justify-content: space-between;
	align-items: center;
	font-size: 13px;">
	<label for="userEmailconfirm" id="userEmailconfirmTxt" >인증번호를 입력해주세요</label>
	<input type="text" class="form-control" 
								id="userEmailconfirm"  size="55" placeholder="인증번호">
	</div>
	
						<br>
						<br>
						<br>
						
						<div class="input-agree" align="right" style="right: auto;color: black; ;font-size:auto;">
							<span>이용약관</span>                            <span>개인정보처리방침</span>
						</div>
						
				<div class="input-check" align="left"style="left: auto;">
				<label for="agree_all">
 					 <input type="checkbox" name="agree_all" id="agree_all" value='agreeAll' onclick='agreeAll(this)'>
  				<span>전체 동의합니다</span>
						</label> 

 			<label for="agree">
  				<input type="checkbox"  name="agree" value="1">
  							<span>이용약관 동의<strong>(필수)</strong></span>
			</label>

			<label for="agree">
  					<input type="checkbox"  name="agree" value="2">
  					<span>개인정보 수집, 이용 동의<strong>(필수)</strong></span>
			</label>

		<label for="agree">
  					<input type="checkbox" name="agree" value="3">
  					<span>개인정보 이용 동의<strong>(필수)</strong></span>
		</label> 
      
        
        <label for="userSnswhether">
  				<input type="checkbox" name="userSnswhether" value="Y" id="userSnswhether">
  				<span>SNS 수신동의</span>
		</label>
		<label for=" userEmailwhether">
  		<input type="checkbox" name="userEmailwhether" value="Y" id="userEmailwhether">
  				<span>Email 수신동의</span>
		</label>
    			</div>
						<div style="display: block;  margin: 60px auto; color: dark gray; font-size: 20px; font-weight: bold;">
							<button type="submit" id="submitForm()">Create Account</button>
						</div>
					</div>
				</form>
			</div>
		</main>
			
	</div>
<!--footer1-->
	<div class="d-box" style="background-color: #eee; padding: 30px 0px;">
		<div class="dd-box">
			<div class="container">
				<div class="con1">
					고객센터
					<hr>
					<p style="font-size: 1.1rem;">
						1600-0000<br> 
						<!-- <a href="#">카카오톡 플러스 친구</a> -->
					</p>
					<small>제품문의 · </small>
					<p>평일 09:30 - 17:30 | 점심시간 12:30 - 13:30
				</div>
				<div class="con2">
					기업고객 문의
					<hr>
					<p style="font-size: 1.1rem;">
						02-2222-22222<br> <a href="#">help@200OK.com</a>
					</p>
					<p>평일 10:30 - 17:30 | 점심시간 12:00 - 13:00
				</div>
				<div class="con3">
					Quick Menu
					<hr>
					<a href="#"> About US</a><br>
					<a href="#" style="font-weight: bold;">개인정보처리방침</a><br>
					<a href="#">이용약관</a>
				</div>
				<div class="con4">
					(주)200OK | 대표이사 · 김행운 | 서울특별시 영등포구 hta로 200OK <br>
					1600-0000 | <a href="#">luckyham@200OK.com</a> | 사업자등록번호 ·
					000-00-0000
					<p>
						통신판매업신고 · 2023-서울송파-0000호 | 부가통신사업신고필증 · 000000 <br> 
						개인정보보호 및 청소년보호 책임자 · 김행운 
					<p>Copyright (c) 2023 200OK Inc. All rights reserved
					<p>
				</div>
			</div>
		</div>
	</div>

	<!--footer2-->
	<div class="d-box" style="background-color: #bbb;">
		
			<div calss="foo">
				<div class="foo-ic">
					<a href="#"><img
						src="https://www.slou.co.kr/img/front/main/video.png"></a>
				</div>
				<div class="foo-ic">
					<a href="#"><img
						src="https://www.slou.co.kr/img/front/main/blog.png"></a>
				</div>
				<div class="foo-ic">
					<a href="#"><img
						src="https://www.slou.co.kr/img/front/main/facebook.png"></a>
				</div>
				<div class="foo-ic">
					<a href="#"><img
						src="https://www.slou.co.kr/img/front/main/instagram.png"></a>
				</div>
			</div>
		</div>
	</div>




<script>


//수신동의여부
 function Yncheck(checkbox) {
	  if (checkbox.checked == true) {
	    checkbox.value = "Y";
	  } else {
	    checkbox.value = "N";
	  }
	} 


 function signUp(){
		// 아이디 중복체크 했는지 확인
		var checkId = false;
		// 아이디가 형식에 맞는지
		var idValidation = false;
		// 비밀번호가 형식에 맞는지
		var pwValidation = false;
		// 비밀번호 확인란과 일치하는지
		var pwCheck = false;
		
	
		$("#idValidation").hide();
		$("#pwValidation").hide();
		$("#pwCheckResult").hide();
		
		// 아이디 중복체크
		$("#btnIdCheck").on("click",function(){
			console.log($("#joinForm").serialize());
			console.log($("#joinForm"));
			$.ajax({
				url: '/user/idCheck.do',
				type: 'post',
				data: $("#joinForm").serialize(),
				success: function(obj){
					console.log(obj);
					
					if(obj == 'duplicatedId'){
						alert("중복된 아이디입니다.");
						$("#userId").focus();
					} else {
						if(confirm("사용 가능한 아이디 입니다. '" + $("#userId").val() + 
								"'를(을) 사용하시겠습니까?")) {
							checkId = true;
							$("#btnIdCheck").attr("disabled", true);
						}
					}
				},
				error: function(e){
					console.log(e);
				}
			})				
		});
		
		// 아이디 중복체크 후 다시 아이디를 변경했을 때
		$("#userId").on("change",function(){
			checkId = false;
			$("#btnIdCheck").attr("disabled", false);
		});
		
		// 아이디 유효성 - 영문, 숫자 조합으로 8~16자리
		$("#userId").on("change", function(){
			var regexId = /^(?=.*[a-zA-Z])(?=.*[0-9]).{8,16}$/;
			var resultId = regexId.exec($("#userId").val());
			
			  if(resultId != null){
				  $("#idValidation").hide(); 
               }else{
            	   $("#idValidation").show();
					   $("#userId").focus();
					   $("#btnIdCheck").attr("disabled", true);
               }
		});
		
		
		// 비밀번호 유효성 검사 - 영문, 숫자, 특수문자 조합으로 8~16자리
		function validatePassword(character){
			return /^(?=.*[a-zA-Z])(?=.*[!@#$%^&*+=-])(?=.*[0-9]).{8,16}$/.test(character);
		}
		// 비밀번호 입력될때마다 유효성 검사
		$("#userPwd").on("change",function(){
			// 비밀번호 유효성 처리
			if(!validatePassword($("#userPwd").val())){
				pwValidation = false;
				$("#pwValidation").show();
				$("#userPwd").focus();
			} else {
				pwValidation = true;
				$("#pwValidation").hide();
			}
			
			// 비밀번호 확인까지 입력한 후 다시 비밀번호 재설정할 경우
			if($("#userPwd").val() == $("#userPwCheck").val()){
				pwCheck = true;
				$("#pwCheckResult").css("color", "green");
				$("#pwCheckResult").text("비밀번호가 일치합니다.");
			} else {
				pwCheck = false;
				$("#pwCheckResult").css("color", "red");
				$("#pwCheckResult").text("비밀번호가 일치하지 않습니다.");
			}
		});
		
		// 비밀번호 확인란 입력할 때 일치하는지
		$("#userPwCheck").on("change", function(){
			$("#pwCheckResult").show();
			
			if($("#userPwd").val() == $("#userPwCheck").val()){
				pwCheck = true;
				$("#pwCheckResult").css("color", "green");
				$("#pwCheckResult").text("비밀번호가 일치합니다.");
			} else {
				pwCheck = false;
				$("#pwCheckResult").css("color", "red");
				$("#pwCheckResult").text("비밀번호가 일치하지 않습니다.");
			}
		});
		
		
		
				
		// 회원가입 제출했을 때
		$("#joinForm").on("submit", function(e){
			// 아이디 중복체크가 안됐거나, 중복된 아이디 사용했을 때
			if(!checkId) {
				alert("아이디 중복체크를 진행하세요.");
				$("#userId").focus();
				e.preventDefault();
				return false;
			} 
			
			// 비밀번호 유효성 검사가 틀렸을 때
			if(!pwValidation){
				alert("영문, 숫자, 특수문자 조합의 8~16자리로 설정하세요.");
				$("#userPwd").focus();
				e.preventDefault();
				return;
			}
			// 비밀번호와 비밀번호 확인이 일치하지 않을 때
			if(!pwCheck) {
				alert("비밀번호가 일치하지 않습니다.");
				$("#userPwCheck").focus();
				e.preventDefault();
				return;
			}
			
			
			// 모두 true일 경우 아무것도 작성하지 X
			alert("회원가입이 완료되었습니다!");
		});
	};
		
	
	
	
	
	
	function submitForm() {
		  const userSnswhether = document.getElementById("userSnswhether");
		  const userEmailwhether = document.getElementById("userEmailwhether");
		  Yncheck(Snswhether);
		  Yncheck(Emailwhether);
		  signUp();
		  const xhr = new XMLHttpRequest();
		  xhr.open("POST", "/join");
		  xhr.onload = function() {
		    console.log(xhr.responseText);
		  };
		  const formData = new FormData();
		  formData.append("userSnswhether", Snswhether.value);
		  formData.append("userEmailwhether", userEmailwhether.value);
		  xhr.send(formData);
		}
	
	
	
	
//도로명api
function execPostCode() {
    new daum.Postcode({
        oncomplete: function(data) {

           var fullRoadAddr = data.roadAddress;
           var extraRoadAddr = ''; // 

           if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
               extraRoadAddr += data.bname;
           }
           if(data.buildingName !== '' && data.apartment === 'Y'){
              extraRoadAddr += (extraRoadAddr !== '' ? ', ' + data.buildingName : data.buildingName);
           }
           if(extraRoadAddr !== ''){
               extraRoadAddr = ' (' + extraRoadAddr + ')';
           }
           if(fullRoadAddr !== ''){
               fullRoadAddr += extraRoadAddr;
           }

           console.log(data.zonecode);
           console.log(fullRoadAddr);
           
           
           $("[name=userAddr1]").val(data.zonecode);
           $("[name=userAddr2]").val(fullRoadAddr);
           
          
       }
    }).open();
}


//전체 동의
function agreeAll(agreeAll)  {
	  const checkboxes 
	     = document.querySelectorAll('input[type="checkbox"]');
	  
	  checkboxes.forEach((checkbox) => {
	    checkbox.checked = agreeAll.checked
	  })
	}

//이메일 인증번호
function checkEmail(email) {
    axios({
      method: 'POST',
      url: 'user/userEmailConfirm?userEmail=' + email
    })
      .then(function () {
        alert("해당 이메일로 인증번호 발송이 완료되었습니다. \n 확인부탁드립니다.");
        console.log("email : " + email);
        chkEmailConfirm(email, $userEmailconfirm, $userEmailconfirmTxt);
      });
  }

	// 이메일 인증번호 체크 함수
	function chkEmailConfirm(data, $userEmailconfirm, $userEmailconfirmTxt){
		$userEmailconfirm.on("keyup", function(){
			if (data != $userEmailconfirm.val()) { //
				emconfirmchk = false;
				$userEmailconfirmTxt.html("<span id='emconfirmchk'>인증번호가 잘못되었습니다</span>")
				$("#emconfirmchk").css({
					"color" : "#FA3E3E",
					"font-weight" : "bold",
					"font-size" : "10px"

				})
				//console.log("중복아이디");
			} else { // 아니면 중복아님
				emconfirmchk = true;
				$userEmailconfirmTxt.html("<span id='emconfirmchk'>인증번호 확인 완료</span>")

				$("#emconfirmchk").css({
					"color" : "#0D6EFD",
					"font-weight" : "bold",
					"font-size" : "10px"

				})
			}
		})
	}
	
	
	
	
	
	
	
	
	
</script>





</body>



</html>